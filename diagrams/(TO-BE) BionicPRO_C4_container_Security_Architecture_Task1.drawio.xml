<mxfile host="Electron" agent="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/29.3.0 Chrome/140.0.7339.249 Electron/38.7.2 Safari/537.36" version="29.3.0">
  <diagram name="BionicPRO Container Security Architecture TO-BE" id="bionicpro-tobe-security">
    <mxGraphModel dx="2672" dy="744" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1654" pageHeight="2339" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <object placeholders="1" c4Name="BionicPRO" c4Type="SystemScopeBoundary" c4Application="Software System" label="&lt;font style=&quot;font-size: 16px&quot;&gt;&lt;b&gt;&lt;div style=&quot;text-align: left&quot;&gt;%c4Name%&lt;/div&gt;&lt;/b&gt;&lt;/font&gt;&lt;div style=&quot;text-align: left&quot;&gt;[%c4Application%]&lt;/div&gt;" id="boundary-bionicpro">
          <mxCell parent="1" style="rounded=1;fontSize=11;whiteSpace=wrap;html=1;dashed=1;arcSize=20;fillColor=none;strokeColor=#666666;fontColor=#333333;labelBackgroundColor=none;align=left;verticalAlign=bottom;labelBorderColor=none;spacingTop=0;spacing=10;dashPattern=8 4;metaEdit=1;rotatable=0;perimeter=rectanglePerimeter;noLabel=0;labelPadding=0;allowArrows=0;connectable=0;expand=0;recursiveResize=0;editable=1;pointerEvents=0;absoluteArcSize=1;points=[[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0.25,0],[1,0.5,0],[1,0.75,0],[0.75,1,0],[0.5,1,0],[0.25,1,0],[0,0.75,0],[0,0.5,0],[0,0.25,0]];" vertex="1">
            <mxGeometry height="1100" width="1220" x="400" y="200" as="geometry" />
          </mxCell>
        </object>
        <object placeholders="1" c4Name="Пользователь протеза" c4Type="Person" c4Description="Пользователь бионического протеза, использует мобильное приложение" label="&lt;font style=&quot;font-size: 16px&quot;&gt;&lt;b&gt;%c4Name%&lt;/b&gt;&lt;/font&gt;&lt;div&gt;[%c4Type%]&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;font style=&quot;font-size: 11px&quot;&gt;&lt;font color=&quot;#cccccc&quot;&gt;%c4Description%&lt;/font&gt;&lt;/div&gt;" id="person-user">
          <mxCell parent="1" style="html=1;fontSize=11;dashed=0;whiteSpace=wrap;fillColor=#6C6477;strokeColor=#4D4D4D;fontColor=#ffffff;shape=mxgraph.c4.person2;align=center;metaEdit=1;points=[[0.5,0,0],[1,0.5,0],[1,0.75,0],[0.75,1,0],[0.5,1,0],[0.25,1,0],[0,0.75,0],[0,0.5,0]];resizable=0;" vertex="1">
            <mxGeometry height="180" width="200" x="-20" y="500" as="geometry" />
          </mxCell>
        </object>
        <object placeholders="1" c4Name="Покупатель протеза" c4Type="Person" c4Description="Заказывает и оплачивает протез через интернет-магазин" label="&lt;font style=&quot;font-size: 16px&quot;&gt;&lt;b&gt;%c4Name%&lt;/b&gt;&lt;/font&gt;&lt;div&gt;[%c4Type%]&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;font style=&quot;font-size: 11px&quot;&gt;&lt;font color=&quot;#cccccc&quot;&gt;%c4Description%&lt;/font&gt;&lt;/div&gt;" id="person-buyer">
          <mxCell parent="1" style="html=1;fontSize=11;dashed=0;whiteSpace=wrap;fillColor=#6C6477;strokeColor=#4D4D4D;fontColor=#ffffff;shape=mxgraph.c4.person2;align=center;metaEdit=1;points=[[0.5,0,0],[1,0.5,0],[1,0.75,0],[0.75,1,0],[0.5,1,0],[0.25,1,0],[0,0.75,0],[0,0.5,0]];resizable=0;" vertex="1">
            <mxGeometry height="180" width="200" x="-20" y="200" as="geometry" />
          </mxCell>
        </object>
        <object placeholders="1" c4Name="Оператор производства" c4Type="Person" c4Description="Внутренний сотрудник, работает с CRM" label="&lt;font style=&quot;font-size: 16px&quot;&gt;&lt;b&gt;%c4Name%&lt;/b&gt;&lt;/font&gt;&lt;div&gt;[%c4Type%]&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;font style=&quot;font-size: 11px&quot;&gt;&lt;font color=&quot;#cccccc&quot;&gt;%c4Description%&lt;/font&gt;&lt;/div&gt;" id="person-operator">
          <mxCell parent="1" style="html=1;fontSize=11;dashed=0;whiteSpace=wrap;fillColor=#083F75;strokeColor=#06315C;fontColor=#ffffff;shape=mxgraph.c4.person2;align=center;metaEdit=1;points=[[0.5,0,0],[1,0.5,0],[1,0.75,0],[0.75,1,0],[0.5,1,0],[0.25,1,0],[0,0.75,0],[0,0.5,0]];resizable=0;" vertex="1">
            <mxGeometry height="180" width="200" x="1770" y="200" as="geometry" />
          </mxCell>
        </object>
        <object placeholders="1" c4Name="ML-инженер" c4Type="Person" c4Description="Работает с данными телеметрии для улучшения моделей" label="&lt;font style=&quot;font-size: 16px&quot;&gt;&lt;b&gt;%c4Name%&lt;/b&gt;&lt;/font&gt;&lt;div&gt;[%c4Type%]&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;font style=&quot;font-size: 11px&quot;&gt;&lt;font color=&quot;#cccccc&quot;&gt;%c4Description%&lt;/font&gt;&lt;/div&gt;" id="person-ml-engineer">
          <mxCell parent="1" style="html=1;fontSize=11;dashed=0;whiteSpace=wrap;fillColor=#083F75;strokeColor=#06315C;fontColor=#ffffff;shape=mxgraph.c4.person2;align=center;metaEdit=1;points=[[0.5,0,0],[1,0.5,0],[1,0.75,0],[0.75,1,0],[0.5,1,0],[0.25,1,0],[0,0.75,0],[0,0.5,0]];resizable=0;" vertex="1">
            <mxGeometry height="180" width="200" x="1770" y="1020" as="geometry" />
          </mxCell>
        </object>
        <object placeholders="1" c4Name="Программа в чипе протеза" c4Type="Software System" c4Description="Чтение миосигналов, управление актуаторами, передача телеметрии [C++, ESP32]" label="&lt;font style=&quot;font-size: 16px&quot;&gt;&lt;b&gt;%c4Name%&lt;/b&gt;&lt;/font&gt;&lt;div&gt;[%c4Type%]&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;font style=&quot;font-size: 11px&quot;&gt;&lt;font color=&quot;#cccccc&quot;&gt;%c4Description%&lt;/font&gt;&lt;/div&gt;" id="system-prosthesis-chip">
          <mxCell parent="1" style="rounded=1;whiteSpace=wrap;html=1;labelBackgroundColor=none;fillColor=#1061B0;fontColor=#ffffff;align=center;arcSize=10;strokeColor=#0D5091;metaEdit=1;resizable=0;points=[[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0.25,0],[1,0.5,0],[1,0.75,0],[0.75,1,0],[0.5,1,0],[0.25,1,0],[0,0.75,0],[0,0.5,0],[0,0.25,0]];" vertex="1">
            <mxGeometry height="120" width="240" x="-40" y="900" as="geometry" />
          </mxCell>
        </object>
        <object placeholders="1" c4Name="LDAP Russia" c4Type="Software System" c4Description="Учётные записи сотрудников и клиентов РФ представительства" label="&lt;font style=&quot;font-size: 16px&quot;&gt;&lt;b&gt;%c4Name%&lt;/b&gt;&lt;/font&gt;&lt;div&gt;[%c4Type%]&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;font style=&quot;font-size: 11px&quot;&gt;&lt;font color=&quot;#cccccc&quot;&gt;%c4Description%&lt;/font&gt;&lt;/div&gt;" id="system-ldap-russia">
          <mxCell parent="1" style="rounded=1;whiteSpace=wrap;html=1;labelBackgroundColor=none;fillColor=#1061B0;fontColor=#ffffff;align=center;arcSize=10;strokeColor=#0D5091;metaEdit=1;resizable=0;points=[[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0.25,0],[1,0.5,0],[1,0.75,0],[0.75,1,0],[0.5,1,0],[0.25,1,0],[0,0.75,0],[0,0.5,0],[0,0.25,0]];" vertex="1">
            <mxGeometry height="120" width="240" x="-40" y="1400" as="geometry" />
          </mxCell>
        </object>
        <object placeholders="1" c4Name="LDAP Europe" c4Type="Software System" c4Description="Учётные записи европейского представительства" label="&lt;font style=&quot;font-size: 16px&quot;&gt;&lt;b&gt;%c4Name%&lt;/b&gt;&lt;/font&gt;&lt;div&gt;[%c4Type%]&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;font style=&quot;font-size: 11px&quot;&gt;&lt;font color=&quot;#cccccc&quot;&gt;%c4Description%&lt;/font&gt;&lt;/div&gt;" id="system-ldap-europe">
          <mxCell parent="1" style="rounded=1;whiteSpace=wrap;html=1;labelBackgroundColor=none;fillColor=#1061B0;fontColor=#ffffff;align=center;arcSize=10;strokeColor=#0D5091;metaEdit=1;resizable=0;points=[[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0.25,0],[1,0.5,0],[1,0.75,0],[0.75,1,0],[0.5,1,0],[0.25,1,0],[0,0.75,0],[0,0.5,0],[0,0.25,0]];" vertex="1">
            <mxGeometry height="120" width="240" x="230" y="1400" as="geometry" />
          </mxCell>
        </object>
        <object placeholders="1" c4Name="Яндекс ID" c4Type="Software System" c4Description="OAuth 2.0 провайдер для российских пользователей" label="&lt;font style=&quot;font-size: 16px&quot;&gt;&lt;b&gt;%c4Name%&lt;/b&gt;&lt;/font&gt;&lt;div&gt;[%c4Type%]&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;font style=&quot;font-size: 11px&quot;&gt;&lt;font color=&quot;#cccccc&quot;&gt;%c4Description%&lt;/font&gt;&lt;/div&gt;" id="system-yandex-id">
          <mxCell parent="1" style="rounded=1;whiteSpace=wrap;html=1;labelBackgroundColor=none;fillColor=#1061B0;fontColor=#ffffff;align=center;arcSize=10;strokeColor=#0D5091;metaEdit=1;resizable=0;points=[[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0.25,0],[1,0.5,0],[1,0.75,0],[0.75,1,0],[0.5,1,0],[0.25,1,0],[0,0.75,0],[0,0.5,0],[0,0.25,0]];" vertex="1">
            <mxGeometry height="120" width="240" x="620" y="1400" as="geometry" />
          </mxCell>
        </object>
        <object placeholders="1" c4Name="Other IdP" c4Type="Software System" c4Description="Другие внешние IdP (Google, Apple и др.)" label="&lt;font style=&quot;font-size: 16px&quot;&gt;&lt;b&gt;%c4Name%&lt;/b&gt;&lt;/font&gt;&lt;div&gt;[%c4Type%]&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;font style=&quot;font-size: 11px&quot;&gt;&lt;font color=&quot;#cccccc&quot;&gt;%c4Description%&lt;/font&gt;&lt;/div&gt;" id="system-other-idp">
          <mxCell parent="1" style="rounded=1;whiteSpace=wrap;html=1;labelBackgroundColor=none;fillColor=#1061B0;fontColor=#ffffff;align=center;arcSize=10;strokeColor=#0D5091;metaEdit=1;resizable=0;points=[[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0.25,0],[1,0.5,0],[1,0.75,0],[0.75,1,0],[0.5,1,0],[0.25,1,0],[0,0.75,0],[0,0.5,0],[0,0.25,0]];" vertex="1">
            <mxGeometry height="120" width="240" x="920" y="1400" as="geometry" />
          </mxCell>
        </object>
        <object placeholders="1" c4Name="Интернет-магазин" c4Type="Container" c4Technology="Битрикс24, React" c4Description="Выбор и заказ протезов" label="&lt;font style=&quot;font-size: 16px&quot;&gt;&lt;b&gt;%c4Name%&lt;/b&gt;&lt;/font&gt;&lt;div&gt;[%c4Type%: %c4Technology%]&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;font style=&quot;font-size: 11px&quot;&gt;&lt;font color=&quot;#E6E6E6&quot;&gt;%c4Description%&lt;/font&gt;&lt;/div&gt;" id="container-web-shop">
          <mxCell parent="1" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;labelBackgroundColor=none;fillColor=#23A2D9;fontColor=#ffffff;align=center;arcSize=10;strokeColor=#0E7DAD;metaEdit=1;resizable=0;points=[[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0.25,0],[1,0.5,0],[1,0.75,0],[0.75,1,0],[0.5,1,0],[0.25,1,0],[0,0.75,0],[0,0.5,0],[0,0.25,0]];" vertex="1">
            <mxGeometry height="120" width="240" x="440" y="230" as="geometry" />
          </mxCell>
        </object>
        <object placeholders="1" c4Name="Мобильное приложение" c4Type="Container" c4Technology="iOS, Android" c4Description="Донастройка протеза, просмотр отчётов. Работает через сессионные cookie" label="&lt;font style=&quot;font-size: 16px&quot;&gt;&lt;b&gt;%c4Name%&lt;/b&gt;&lt;/font&gt;&lt;div&gt;[%c4Type%: %c4Technology%]&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;font style=&quot;font-size: 11px&quot;&gt;&lt;font color=&quot;#E6E6E6&quot;&gt;%c4Description%&lt;/font&gt;&lt;/div&gt;" id="container-mobile-app">
          <mxCell parent="1" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;labelBackgroundColor=none;fillColor=#23A2D9;fontColor=#ffffff;align=center;arcSize=10;strokeColor=#0E7DAD;metaEdit=1;resizable=0;points=[[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0.25,0],[1,0.5,0],[1,0.75,0],[0.75,1,0],[0.5,1,0],[0.25,1,0],[0,0.75,0],[0,0.5,0],[0,0.25,0]];" vertex="1">
            <mxGeometry height="120" width="240" x="440" y="530" as="geometry" />
          </mxCell>
        </object>
        <object placeholders="1" c4Name="CRM" c4Type="Container" c4Technology="Битрикс24" c4Description="Управление заказами и клиентами" label="&lt;font style=&quot;font-size: 16px&quot;&gt;&lt;b&gt;%c4Name%&lt;/b&gt;&lt;/font&gt;&lt;div&gt;[%c4Type%: %c4Technology%]&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;font style=&quot;font-size: 11px&quot;&gt;&lt;font color=&quot;#E6E6E6&quot;&gt;%c4Description%&lt;/font&gt;&lt;/div&gt;" id="container-crm">
          <mxCell parent="1" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;labelBackgroundColor=none;fillColor=#23A2D9;fontColor=#ffffff;align=center;arcSize=10;strokeColor=#0E7DAD;metaEdit=1;resizable=0;points=[[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0.25,0],[1,0.5,0],[1,0.75,0],[0.75,1,0],[0.5,1,0],[0.25,1,0],[0,0.75,0],[0,0.5,0],[0,0.25,0]];" vertex="1">
            <mxGeometry height="120" width="240" x="1100" y="230" as="geometry" />
          </mxCell>
        </object>
        <object placeholders="1" c4Name="Keycloak" c4Type="Container" c4Technology="Identity Broker" c4Description="Центральный IdP с поддержкой MFA/OTP. User Federation с LDAP, Identity Brokering с внешними IdP" label="&lt;font style=&quot;font-size: 16px&quot;&gt;&lt;b&gt;%c4Name%&lt;/b&gt;&lt;/font&gt;&lt;div&gt;[%c4Type%: %c4Technology%]&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;font style=&quot;font-size: 11px&quot;&gt;&lt;font color=&quot;#E6E6E6&quot;&gt;%c4Description%&lt;/font&gt;&lt;/div&gt;" id="container-keycloak">
          <mxCell parent="1" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;labelBackgroundColor=none;fillColor=#23A2D9;fontColor=#ffffff;align=center;arcSize=10;strokeColor=#0E7DAD;metaEdit=1;resizable=0;points=[[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0.25,0],[1,0.5,0],[1,0.75,0],[0.75,1,0],[0.5,1,0],[0.25,1,0],[0,0.75,0],[0,0.5,0],[0,0.25,0]];" vertex="1">
            <mxGeometry height="120" width="240" x="620" y="1060" as="geometry" />
          </mxCell>
        </object>
        <object placeholders="1" c4Name="bionicpro-auth" c4Type="Container" c4Technology="Java / Spring Security" c4Description="BFF для аутентификации. Хранит токены серверно, выдаёт HTTP-only session cookie. Реализует PKCE flow" label="&lt;font style=&quot;font-size: 16px&quot;&gt;&lt;b&gt;%c4Name%&lt;/b&gt;&lt;/font&gt;&lt;div&gt;[%c4Type%: %c4Technology%]&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;font style=&quot;font-size: 11px&quot;&gt;&lt;font color=&quot;#E6E6E6&quot;&gt;%c4Description%&lt;/font&gt;&lt;/div&gt;" id="container-auth-service">
          <mxCell parent="1" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;labelBackgroundColor=none;fillColor=#23A2D9;fontColor=#ffffff;align=center;arcSize=10;strokeColor=#0E7DAD;metaEdit=1;resizable=0;points=[[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0.25,0],[1,0.5,0],[1,0.75,0],[0.75,1,0],[0.5,1,0],[0.25,1,0],[0,0.75,0],[0,0.5,0],[0,0.25,0]];" vertex="1">
            <mxGeometry height="120" width="240" x="440" y="820" as="geometry" />
          </mxCell>
        </object>
        <object placeholders="1" c4Name="Session Store" c4Type="Container" c4Technology="Redis" c4Description="Хранение сессий, access и refresh токенов в зашифрованном виде" label="&lt;font style=&quot;font-size: 16px&quot;&gt;&lt;b&gt;%c4Name%&lt;/b&gt;&lt;/font&gt;&lt;div&gt;[%c4Type%:&amp;nbsp;%c4Technology%]&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;font style=&quot;font-size: 11px&quot;&gt;&lt;font color=&quot;#E6E6E6&quot;&gt;%c4Description%&lt;/font&gt;&lt;/div&gt;" id="container-session-store">
          <mxCell parent="1" style="shape=cylinder3;size=15;whiteSpace=wrap;html=1;boundedLbl=1;rounded=0;labelBackgroundColor=none;fillColor=#23A2D9;fontSize=12;fontColor=#ffffff;align=center;strokeColor=#0E7DAD;metaEdit=1;points=[[0.5,0,0],[1,0.25,0],[1,0.5,0],[1,0.75,0],[0.5,1,0],[0,0.75,0],[0,0.5,0],[0,0.25,0]];resizable=0;" vertex="1">
            <mxGeometry height="120" width="240" x="850" y="830" as="geometry" />
          </mxCell>
        </object>
        <object placeholders="1" c4Name="API Gateway" c4Type="Container" c4Technology="Spring Boot" c4Description="Основной API. Проверяет сессии через bionicpro-auth" label="&lt;font style=&quot;font-size: 16px&quot;&gt;&lt;b&gt;%c4Name%&lt;/b&gt;&lt;/font&gt;&lt;div&gt;[%c4Type%: %c4Technology%]&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;font style=&quot;font-size: 11px&quot;&gt;&lt;font color=&quot;#E6E6E6&quot;&gt;%c4Description%&lt;/font&gt;&lt;/div&gt;" id="container-api-gateway">
          <mxCell parent="1" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;labelBackgroundColor=none;fillColor=#23A2D9;fontColor=#ffffff;align=center;arcSize=10;strokeColor=#0E7DAD;metaEdit=1;resizable=0;points=[[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0.25,0],[1,0.5,0],[1,0.75,0],[0.75,1,0],[0.5,1,0],[0.25,1,0],[0,0.75,0],[0,0.5,0],[0,0.25,0]];" vertex="1">
            <mxGeometry height="120" width="240" x="990" y="680" as="geometry" />
          </mxCell>
        </object>
        <object placeholders="1" c4Name="CLI Tool" c4Type="Container" c4Technology="Python" c4Description="Инструмент для ML-инженеров" label="&lt;font style=&quot;font-size: 16px&quot;&gt;&lt;b&gt;%c4Name%&lt;/b&gt;&lt;/font&gt;&lt;div&gt;[%c4Type%: %c4Technology%]&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;font style=&quot;font-size: 11px&quot;&gt;&lt;font color=&quot;#E6E6E6&quot;&gt;%c4Description%&lt;/font&gt;&lt;/div&gt;" id="container-cli-tool">
          <mxCell parent="1" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;labelBackgroundColor=none;fillColor=#23A2D9;fontColor=#ffffff;align=center;arcSize=10;strokeColor=#0E7DAD;metaEdit=1;resizable=0;points=[[0.25,0,0],[0.5,0,0],[0.75,0,0],[1,0.25,0],[1,0.5,0],[1,0.75,0],[0.75,1,0],[0.5,1,0],[0.25,1,0],[0,0.75,0],[0,0.5,0],[0,0.25,0]];" vertex="1">
            <mxGeometry height="120" width="240" x="1350" y="1050" as="geometry" />
          </mxCell>
        </object>
        <object placeholders="1" c4Name="CRM DB" c4Type="Container" c4Technology="PostgreSQL" c4Description="Данные клиентов и заказов" label="&lt;font style=&quot;font-size: 16px&quot;&gt;&lt;b&gt;%c4Name%&lt;/b&gt;&lt;/font&gt;&lt;div&gt;[%c4Type%:&amp;nbsp;%c4Technology%]&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;font style=&quot;font-size: 11px&quot;&gt;&lt;font color=&quot;#E6E6E6&quot;&gt;%c4Description%&lt;/font&gt;&lt;/div&gt;" id="container-crm-db">
          <mxCell parent="1" style="shape=cylinder3;size=15;whiteSpace=wrap;html=1;boundedLbl=1;rounded=0;labelBackgroundColor=none;fillColor=#23A2D9;fontSize=12;fontColor=#ffffff;align=center;strokeColor=#0E7DAD;metaEdit=1;points=[[0.5,0,0],[1,0.25,0],[1,0.5,0],[1,0.75,0],[0.5,1,0],[0,0.75,0],[0,0.5,0],[0,0.25,0]];resizable=0;" vertex="1">
            <mxGeometry height="120" width="240" x="1100" y="440" as="geometry" />
          </mxCell>
        </object>
        <object placeholders="1" c4Name="Telemetry DB" c4Type="Container" c4Technology="PostgreSQL" c4Description="Данные телеметрии протезов" label="&lt;font style=&quot;font-size: 16px&quot;&gt;&lt;b&gt;%c4Name%&lt;/b&gt;&lt;/font&gt;&lt;div&gt;[%c4Type%:&amp;nbsp;%c4Technology%]&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;font style=&quot;font-size: 11px&quot;&gt;&lt;font color=&quot;#E6E6E6&quot;&gt;%c4Description%&lt;/font&gt;&lt;/div&gt;" id="container-telemetry-db">
          <mxCell parent="1" style="shape=cylinder3;size=15;whiteSpace=wrap;html=1;boundedLbl=1;rounded=0;labelBackgroundColor=none;fillColor=#23A2D9;fontSize=12;fontColor=#ffffff;align=center;strokeColor=#0E7DAD;metaEdit=1;points=[[0.5,0,0],[1,0.25,0],[1,0.5,0],[1,0.75,0],[0.5,1,0],[0,0.75,0],[0,0.5,0],[0,0.25,0]];resizable=0;" vertex="1">
            <mxGeometry height="120" width="240" x="1350" y="680" as="geometry" />
          </mxCell>
        </object>
        <mxCell id="rel-user-mobile" edge="1" parent="1" source="person-user" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="container-mobile-app">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="rel-user-mobile-label" connectable="0" parent="rel-user-mobile" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" value="Донастройка протеза&lt;br&gt;[HTTPS]" vertex="1">
          <mxGeometry relative="1" x="0.1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="rel-user-chip" edge="1" parent="1" source="person-user" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="system-prosthesis-chip">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="rel-user-chip-label" connectable="0" parent="rel-user-chip" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" value="Миосигналы" vertex="1">
          <mxGeometry relative="1" x="0.1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="rel-buyer-webshop" edge="1" parent="1" source="person-buyer" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="container-web-shop">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="rel-buyer-webshop-label" connectable="0" parent="rel-buyer-webshop" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" value="Заказ протеза&lt;br&gt;[HTTPS]" vertex="1">
          <mxGeometry relative="1" x="0.1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="rel-operator-crm" edge="1" parent="1" source="person-operator" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="container-crm">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="rel-operator-crm-label" connectable="0" parent="rel-operator-crm" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" value="Управление заказами&lt;br&gt;[HTTPS]" vertex="1">
          <mxGeometry relative="1" x="0.1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="rel-ml-cli" edge="1" parent="1" source="person-ml-engineer" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="container-cli-tool">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="rel-ml-cli-label" connectable="0" parent="rel-ml-cli" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" value="Анализ данных&lt;br&gt;[CLI]" vertex="1">
          <mxGeometry relative="1" x="0.1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="rel-webshop-crm" edge="1" parent="1" source="container-web-shop" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="container-crm">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="rel-webshop-crm-label" connectable="0" parent="rel-webshop-crm" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" value="Заказы&lt;br&gt;[REST / JSON]" vertex="1">
          <mxGeometry relative="1" x="0.1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="rel-mobile-auth" edge="1" parent="1" source="container-mobile-app" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="container-auth-service">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="rel-mobile-auth-label" connectable="0" parent="rel-mobile-auth" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" value="Session Cookie&lt;br&gt;(HTTP-only, Secure)&lt;br&gt;[HTTPS]" vertex="1">
          <mxGeometry relative="1" x="0.1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="rel-mobile-api" edge="1" parent="1" source="container-mobile-app" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="container-api-gateway">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="rel-mobile-api-label" connectable="0" parent="rel-mobile-api" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" value="REST API + Session Cookie&lt;br&gt;[HTTPS]" vertex="1">
          <mxGeometry relative="1" x="0.1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="rel-auth-keycloak" edge="1" parent="1" source="container-auth-service" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="container-keycloak">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="rel-auth-keycloak-label" connectable="0" parent="rel-auth-keycloak" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" value="OAuth 2.0 PKCE&lt;br&gt;Code Grant&lt;br&gt;[HTTPS]" vertex="1">
          <mxGeometry relative="1" x="0.1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="rel-auth-session" edge="1" parent="1" source="container-auth-service" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="container-session-store">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="rel-auth-session-label" connectable="0" parent="rel-auth-session" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" value="Хранение токенов&lt;br&gt;(зашифрованы)&lt;br&gt;[TLS]" vertex="1">
          <mxGeometry relative="1" x="0.1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="rel-api-auth" edge="1" parent="1" source="container-api-gateway" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="container-auth-service">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="630" y="740" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="rel-api-auth-label" connectable="0" parent="rel-api-auth" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" value="Валидация сессии&lt;br&gt;[REST]" vertex="1">
          <mxGeometry relative="1" x="0.1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="rel-keycloak-ldap-ru" edge="1" parent="1" source="container-keycloak" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="system-ldap-russia">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="rel-keycloak-ldap-ru-label" connectable="0" parent="rel-keycloak-ldap-ru" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" value="User Federation&lt;br&gt;[LDAPS]" vertex="1">
          <mxGeometry relative="1" x="0.1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="rel-keycloak-ldap-eu" edge="1" parent="1" source="container-keycloak" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="system-ldap-europe">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="350" y="1130" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="rel-keycloak-ldap-eu-label" connectable="0" parent="rel-keycloak-ldap-eu" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" value="User Federation&lt;br&gt;[LDAPS]" vertex="1">
          <mxGeometry relative="1" x="0.1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="rel-keycloak-yandex" edge="1" parent="1" source="container-keycloak" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="system-yandex-id">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="rel-keycloak-yandex-label" connectable="0" parent="rel-keycloak-yandex" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" value="Identity Brokering&lt;br&gt;[OAuth 2.0]" vertex="1">
          <mxGeometry relative="1" x="0.1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="rel-keycloak-other" edge="1" parent="1" source="container-keycloak" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="system-other-idp">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="rel-keycloak-other-label" connectable="0" parent="rel-keycloak-other" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" value="Identity Brokering&lt;br&gt;[OIDC / OAuth 2.0]" vertex="1">
          <mxGeometry relative="1" x="0.1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="rel-chip-api" edge="1" parent="1" source="system-prosthesis-chip" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="container-api-gateway">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="rel-chip-api-label" connectable="0" parent="rel-chip-api" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" value="Телеметрия&lt;br&gt;[HTTPS / 4G]" vertex="1">
          <mxGeometry relative="1" x="0.1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="rel-api-telemetry" edge="1" parent="1" source="container-api-gateway" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="container-telemetry-db">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="rel-api-telemetry-label" connectable="0" parent="rel-api-telemetry" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" value="Чтение/запись&lt;br&gt;телеметрии&lt;br&gt;[SQL]" vertex="1">
          <mxGeometry relative="1" x="0.1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="rel-crm-crmdb" edge="1" parent="1" source="container-crm" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="container-crm-db">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="rel-crm-crmdb-label" connectable="0" parent="rel-crm-crmdb" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" value="Чтение/запись&lt;br&gt;данных клиентов&lt;br&gt;[SQL]" vertex="1">
          <mxGeometry relative="1" x="0.1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="rel-cli-telemetry" edge="1" parent="1" source="container-cli-tool" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="container-telemetry-db">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="rel-cli-telemetry-label" connectable="0" parent="rel-cli-telemetry" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" value="Чтение данных&lt;br&gt;для ML&lt;br&gt;[SQL]" vertex="1">
          <mxGeometry relative="1" x="0.1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="note-bff" parent="1" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;fillColor=#fff2cc;strokeColor=#d6b656;align=left;verticalAlign=top;spacingLeft=5;spacingTop=5;fontSize=10;" value="&lt;b&gt;BFF-паттерн (Backend for Frontend):&lt;/b&gt;&lt;br&gt;• Фронтенд не имеет доступа к access/refresh токенам от IdP&lt;br&gt;• Токены хранятся в Redis в зашифрованном виде&lt;br&gt;• Фронтенд работает только с session cookie (HTTP-only, Secure)&lt;br&gt;• Автоматическое обновление access_token через refresh_token&lt;br&gt;• Ротация session ID для защиты от session fixation attack" vertex="1">
          <mxGeometry height="120" width="300" x="600" y="1550" as="geometry" />
        </mxCell>
        <mxCell id="note-keycloak" parent="1" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;fillColor=#fff2cc;strokeColor=#d6b656;align=left;verticalAlign=top;spacingLeft=5;spacingTop=5;fontSize=10;" value="&lt;b&gt;Keycloak как Identity Broker:&lt;/b&gt;&lt;br&gt;• User Federation: синхронизация с LDAP серверами представительств (только аутентификационные данные)&lt;br&gt;• Identity Brokering: внешние IdP (Яндекс ID, Google, Apple)&lt;br&gt;• MFA/OTP: обязательная двухфакторная аутентификация&lt;br&gt;• Маппинг ролей между представительствами" vertex="1">
          <mxGeometry height="120" width="260" x="270" y="1550" as="geometry" />
        </mxCell>
        <mxCell id="note-localization" parent="1" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;fillColor=#fff2cc;strokeColor=#d6b656;align=left;verticalAlign=top;spacingLeft=5;spacingTop=5;fontSize=10;" value="&lt;b&gt;Принципы локализации данных:&lt;/b&gt;&lt;br&gt;• Персональные и медицинские данные остаются в локальных БД страны&lt;br&gt;• Keycloak синхронизирует только аутентификационные атрибуты" vertex="1">
          <mxGeometry height="120" width="250" x="-40" y="1550" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
